<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" type="text/css" href="login.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>
        // // URLパラメータを取得する関数
        // async function getParameterByName(name, url = window.location.href) {
        //     name = name.replace(/[[\]]/g, '\\$&');
        //     var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        //         results = regex.exec(url);
        //     if (!results) return null;
        //     if (!results[2]) return '';
        //     return decodeURIComponent(results[2].replace(/\+/g, ' '));
        // }

        // // 座標情報を取得
        // var row = getParameterByName('row');
        // var column = getParameterByName('column');

        // // 座標情報を表示
        // var header = document.getElementById('header');
        // header.innerHTML = 'クリックした座標：' + row + '行' + column + '列';

        osql.requireLogin();

        var me;

        var row = osql.getParam('row');
        var column = osql.getParam('column');
        var block = ''

        $(document).ready(async function () {
            me = await osql.getMe();

            var date = ''
            if (column == 2) {
                date = '月';
            } else if (column == 3) {
                date = '火';
            } else if (column == 4) {
                date = '水';
            } else if (column == 5) {
                date = '木';
            } else if (column == 6) {
                date = '金';
            }
            block = date + String(row - 1);
            document.getElementById('block').innerHTML = block;

            await displayPlans();
        });

        async function displayPlans() {
            document.getElementById('block2').innerHTML = block;
            var sql = `select * from Plans where user_id = '${me.id}' and block = '${block}' and affiliation = ${0}`;
            var object = await osql.connect(sql);
            var scheduleHere = object[0].schedule;
            document.getElementById('schedule').value = scheduleHere;
            var availabilityHere = object[0].availability;
            document.getElementById('availability').value = availabilityHere;


        }




    </script>

</head>

<body>
    <header>
        <div style="text-align: right;">
            ようこそ<span id="lastname"></span> <span id="firstname"></span>さん
            <a href="index.html">top</a>
        </div>
        <h1 id="header">あなたの<span id="block"></span>の編集ページ</h1>
    </header>


    <a href="myTimetable.html" class="footer-button">戻る</a>

    <div>
        あなたの<span id="block2"></span>の予定
        <br>
        <input id="schedule" value="" type="textfield">
        <br>
        予定の変更可能具合
        現在：<input id="availability" value="" type="textfield">

        変更：<select id="select-availability">
            <option value='○'>○</option>
            <option value='△'>△</option>
            <option value='×'>×</option>
        </select>
    </div>
</body>

</html>